import{a as A,b as E,u as K,c as G,N as H,d as Q}from"./search-form.vue_vue_type_script_setup_true_lang-Hz521IbE.js";import{bm as $,d as C,Q as O,R as M,o as S,c as x,w as r,f as a,h as e,$ as t,X,bZ as Y,s as Z,a6 as J,z as U,bo as ee,g as f,t as y,a9 as R,b_ as j,bY as F,P as V,bk as te,b$ as ae,bl as le,C as oe,ad as ne,b as re,ae as T,B as W,O as se,ag as ue}from"./index-BztLELzb.js";import{_ as ie}from"./select-group.vue_vue_type_script_setup_true_lang-DXA2Evh-.js";import{_ as pe}from"./select-scene.vue_vue_type_script_setup_true_lang-DZYcuyFp.js";import{_ as de}from"./detail-drawer-CaKEzTf2.js";import{_ as me,a as ce}from"./log-CU3xmgB7.js";import{_ as ge,a as fe}from"./DescriptionsItem-gUlfoQM0.js";import{_ as ye}from"./Grid-DDhjb_3_.js";import"./group-XSuFGJhJ.js";import"./retry-scene-y84vzAuY.js";function _e(d){return $({url:"/retry-task-log/list",method:"get",params:d})}function be(d){return $({url:`/retry-task-log/${d}`,method:"get"})}function ve(d){return $({url:`/retry-task-log/${d}`,method:"delete"})}function he(d){return $({url:"/retry-task-log/ids",method:"delete",data:d})}const Ne=C({name:"RetryLogSearch",__name:"retry-log-search",props:{model:{required:!0},modelModifiers:{}},emits:O(["reset","search"],["update:model"]),setup(d,{emit:h}){const _=h,s=M(d,"model");function b(){_("reset")}function D(){_("search")}return(N,i)=>{const c=A,g=Z,w=J,L=E;return S(),x(L,{model:s.value,onSearch:D,onReset:b},{default:r(()=>[a(c,{span:"24 s:12 m:6",label:e(t)("page.retryLog.groupName"),path:"groupName",class:"pr-24px"},{default:r(()=>[a(ie,{value:s.value.groupName,"onUpdate:value":i[0]||(i[0]=l=>s.value.groupName=l)},null,8,["value"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(t)("page.retryLog.sceneName"),path:"sceneName",class:"pr-24px"},{default:r(()=>[a(pe,{value:s.value.sceneName,"onUpdate:value":i[1]||(i[1]=l=>s.value.sceneName=l),"group-name":s.value.groupName},null,8,["value","group-name"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(t)("page.retryLog.UniqueId"),path:"UniqueId",class:"pr-24px"},{default:r(()=>[a(g,{value:s.value.uniqueId,"onUpdate:value":i[2]||(i[2]=l=>s.value.uniqueId=l),placeholder:e(t)("page.retryLog.form.UniqueId")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(t)("page.retryLog.idempotentId"),path:"idempotentId",class:"pr-24px"},{default:r(()=>[a(g,{value:s.value.idempotentId,"onUpdate:value":i[3]||(i[3]=l=>s.value.idempotentId=l),placeholder:e(t)("page.retryLog.form.idempotentId")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(t)("page.retryLog.bizNo"),path:"bizNo",class:"pr-24px"},{default:r(()=>[a(g,{value:s.value.bizNo,"onUpdate:value":i[4]||(i[4]=l=>s.value.bizNo=l),placeholder:e(t)("page.retryLog.form.bizNo")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{span:"24 s:12 m:6",label:e(t)("page.retryLog.retryStatus"),path:"taskBatchStatus",class:"pr-24px"},{default:r(()=>[a(w,{value:s.value.retryStatus,"onUpdate:value":i[5]||(i[5]=l=>s.value.retryStatus=l),placeholder:e(t)("page.retryTask.form.retryStatus"),options:e(X)(e(Y)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),we=C({name:"SceneDetailDrawer",__name:"retry-log-detail-drawer",props:O({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(d){const h=d,_=M(d,"visible"),s=U([]),b=U(),D=new AbortController,N=U(!1);let i="0",c=0;async function g(){const{data:l,error:v}=await ce({groupName:h.rowData.groupName,uniqueId:h.rowData.uniqueId,startId:i,fromIndex:c,size:50});v||(N.value=l.finished,i=l.nextStartId,c=l.fromIndex,l.message&&(s.value.push(...l.message),s.value.sort((p,k)=>Number.parseInt(p.time_stamp,10)-Number.parseInt(k.time_stamp,10))),N.value||(clearTimeout(b.value),b.value=setTimeout(g,1e3)))}const w=async l=>{l===1&&s.value.length===0&&await g()},L=()=>{N.value=!0,D.abort(),clearTimeout(b.value),b.value=void 0};return ee(()=>{L()}),(l,v)=>{const p=ge,k=V,q=fe,I=te,u=me,n=ae,z=le,B=de;return S(),x(B,{modelValue:_.value,"onUpdate:modelValue":v[1]||(v[1]=o=>_.value=o),title:e(t)("page.retryLog.detail"),width:["50%","90%"]},{default:r(()=>[a(z,{type:"segment",animated:"","onUpdate:value":w},{default:r(()=>[a(I,{name:0,tab:e(t)("page.log.info")},{default:r(()=>[a(q,{"label-placement":"top",bordered:"",column:2},{default:r(()=>[a(p,{label:e(t)("page.retryLog.UniqueId"),span:2},{default:r(()=>{var o;return[f(y((o=l.rowData)==null?void 0:o.uniqueId),1)]}),_:1},8,["label"]),a(p,{label:e(t)("page.retryLog.groupName"),span:2},{default:r(()=>{var o;return[f(y((o=l.rowData)==null?void 0:o.groupName),1)]}),_:1},8,["label"]),a(p,{label:e(t)("page.retryLog.sceneName"),span:2},{default:r(()=>{var o;return[f(y((o=l.rowData)==null?void 0:o.sceneName),1)]}),_:1},8,["label"]),a(p,{label:e(t)("page.retryLog.retryStatus"),span:1},{default:r(()=>{var o;return[a(k,{type:e(R)((o=l.rowData)==null?void 0:o.retryStatus)},{default:r(()=>{var m;return[f(y(e(t)(e(j)[(m=l.rowData)==null?void 0:m.retryStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(p,{label:e(t)("page.retryLog.taskType"),span:1},{default:r(()=>{var o;return[a(k,{type:e(R)((o=l.rowData)==null?void 0:o.taskType)},{default:r(()=>{var m;return[f(y(e(t)(e(F)[(m=l.rowData)==null?void 0:m.taskType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),a(p,{label:e(t)("page.retryLog.bizNo"),span:2},{default:r(()=>{var o;return[f(y((o=l.rowData)==null?void 0:o.bizNo),1)]}),_:1},8,["label"]),a(p,{label:e(t)("page.retryLog.idempotentId"),span:2},{default:r(()=>{var o;return[f(y((o=l.rowData)==null?void 0:o.idempotentId),1)]}),_:1},8,["label"]),a(p,{label:e(t)("page.retryTask.executorName"),span:2},{default:r(()=>{var o;return[f(y((o=l.rowData)==null?void 0:o.executorName),1)]}),_:1},8,["label"]),a(p,{label:e(t)("page.retryTask.argsStr"),span:2},{default:r(()=>{var o;return[f(y((o=l.rowData)==null?void 0:o.argsStr),1)]}),_:1},8,["label"]),a(p,{label:e(t)("common.createDt")},{default:r(()=>{var o;return[f(y((o=l.rowData)==null?void 0:o.createDt),1)]}),_:1},8,["label"])]),_:1})]),_:1},8,["tab"]),a(I,{name:1,tab:e(t)("page.log.title"),"display-directive":"if"},{default:r(()=>[s.value.length>0?(S(),x(u,{key:0,modelValue:s.value,"onUpdate:modelValue":v[0]||(v[0]=o=>s.value=o),drawer:!1},null,8,["modelValue"])):(S(),x(n,{key:1,class:"h-full"}))]),_:1},8,["tab"])]),_:1})]),_:1},8,["modelValue","title"])}}}),ke={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function P(d){return typeof d=="function"||Object.prototype.toString.call(d)==="[object Object]"&&!ue(d)}const ze=C({name:"retry_log",__name:"index",setup(d){const h=oe(),_=U(),{bool:s,setTrue:b}=ne(!1),D=history.state.retryStatus,{columns:N,columnChecks:i,data:c,getData:g,loading:w,mobilePagination:L,searchParams:l,resetSearchParams:v}=K({apiFn:_e,apiParams:{page:1,size:10,uniqueId:null,groupName:null,sceneName:null,idempotentId:null,bizNo:null,retryStatus:null},searchParams:{retryStatus:D},columns:()=>[{type:"selection",align:"center",width:48,disabled:u=>u.retryStatus!==1},{key:"index",title:t("common.index"),align:"center",width:64},{key:"uniqueId",title:t("page.retryLog.UniqueId"),align:"left",minWidth:120,render:u=>{async function n(){await I(u),b()}return a(W,{text:!0,tag:"a",type:"primary",onClick:n,class:"ws-normal"},{default:()=>[u.uniqueId]})}},{key:"groupName",title:t("page.retryLog.groupName"),align:"left",minWidth:120},{key:"sceneName",title:t("page.retryLog.sceneName"),align:"left",minWidth:120},{key:"retryStatus",title:t("page.retryLog.retryStatus"),align:"left",minWidth:120,render:u=>{if(u.retryStatus===null)return null;const n=t(j[u.retryStatus]);return a(V,{type:R(u.retryStatus)},P(n)?n:{default:()=>[n]})}},{key:"taskType",title:t("page.retryLog.taskType"),align:"left",minWidth:120,render:u=>{if(u.taskType===null)return null;const n=t(F[u.taskType]);return a(V,{type:R(u.taskType)},P(n)?n:{default:()=>[n]})}},{key:"idempotentId",title:t("page.retryLog.idempotentId"),align:"left",minWidth:120},{key:"bizNo",title:t("page.retryLog.bizNo"),align:"left",minWidth:120},{key:"createDt",title:t("page.retryLog.createDt"),align:"left",minWidth:120},{key:"operate",title:t("common.operate"),align:"center",width:130,render:u=>a("div",{class:"flex-center gap-8px"},[u.retryStatus===1?a(H,{onPositiveClick:()=>q(u.id)},{default:()=>t("common.confirmDelete"),trigger:()=>{let n;return a(W,{type:"error",text:!0,ghost:!0,size:"small"},P(n=t("common.delete"))?n:{default:()=>[n]})}}):""])}]}),{checkedRowKeys:p}=G(c,g);async function k(){var n;const{error:u}=await he(p.value);u||((n=window.$message)==null||n.success(t("common.deleteSuccess")),g())}async function q(u){var n;await ve(u),(n=window.$message)==null||n.success(t("common.deleteSuccess")),g()}async function I(u){const n=await be(u.id);_.value=n.data||null}return(u,n)=>{const z=Q,B=ye,o=se;return S(),re("div",ke,[a(Ne,{model:e(l),"onUpdate:model":n[0]||(n[0]=m=>T(l)?l.value=m:null),onReset:e(v),onSearch:e(g)},null,8,["model","onReset","onSearch"]),a(o,{title:e(t)("page.retryLog.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":r(()=>[a(z,{columns:e(i),"onUpdate:columns":n[1]||(n[1]=m=>T(i)?i.value=m:null),"disabled-delete":e(p).length===0,loading:e(w),"show-add":!1,onDelete:k,onRefresh:e(g)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:r(()=>[a(B,{"checked-row-keys":e(p),"onUpdate:checkedRowKeys":n[2]||(n[2]=m=>T(p)?p.value=m:null),columns:e(N),data:e(c),"flex-height":!e(h).isMobile,"scroll-x":962,loading:e(w),remote:"","row-key":m=>m.id,pagination:e(L),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),a(we,{visible:e(s),"onUpdate:visible":n[3]||(n[3]=m=>T(s)?s.value=m:null),"row-data":_.value},null,8,["visible","row-data"])])}}});export{ze as default};
