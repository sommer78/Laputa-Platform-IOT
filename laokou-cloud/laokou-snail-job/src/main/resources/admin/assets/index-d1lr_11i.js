import{a as ge,b as be,u as _e,c as he,N as ve,d as Se}from"./search-form.vue_vue_type_script_setup_true_lang-Hz521IbE.js";import{d as te,Q as Z,z as F,R as ee,X as z,m as Te,n as Ne,a as we,$ as a,i as ke,aN as Ce,r as De,S as Ie,o as N,c as L,w as n,f as t,g as I,t as U,h as e,bP as Ue,af as q,b as le,U as se,V as ie,by as re,a8 as fe,v as Re,a6 as de,a1 as Le,x as $e,a2 as Ve,bx as xe,s as Oe,y as je,B as Y,bQ as ue,bR as Be,bS as Me,a9 as V,bT as ce,bA as Fe,bU as me,bV as ye,P as W,C as Ae,ad as Ge,ae as E,bW as Pe,bh as ze,O as Ee,ag as We}from"./index-BztLELzb.js";import{d as qe,e as He,g as Ke,h as Qe,i as pe,j as Je}from"./notify-C5Qb6_Qp.js";import{f as Xe}from"./retry-scene-y84vzAuY.js";import{f as Ye}from"./workflow-CNPsY-Xm.js";import{h as Ze}from"./job-8fE21JLD.js";import{_ as et}from"./select-group.vue_vue_type_script_setup_true_lang-DXA2Evh-.js";import{c as tt,d as at,_ as nt}from"./Grid-DDhjb_3_.js";import{_ as ot,a as lt}from"./DescriptionsItem-gUlfoQM0.js";import{_ as st}from"./status-switch.vue_vue_type_script_setup_true_lang-CrGBHwP5.js";import{u as it}from"./auth-Dc2mH7ta.js";import"./group-XSuFGJhJ.js";const rt=te({name:"NotifyConfigOperateDrawer",__name:"notify-config-operate-drawer",props:Z({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{},retrySceneDisable:{type:Boolean,default:!0},retrySceneDisableModifiers:{}}),emits:Z(["update:value","submitted"],["update:visible","update:retrySceneDisable"]),setup(w,{emit:x}){const f=F([]),b=F([]),y=F([]),k=F([]),h=w,S=x,g=ee(w,"visible"),m=ee(w,"retrySceneDisable"),i=F(z(ue)),{formRef:d,validate:A,restoreValidation:ae}=Te(),{defaultRequiredRule:D}=Ne(),ne=we(()=>({add:a("page.notifyConfig.addNotifyConfig"),edit:a("page.notifyConfig.editNotifyConfig")})[h.operateType]);ke(()=>{Ce(()=>{oe()})});async function oe(){const c=await qe();f.value=c.data}const o=De(H());function H(){return{groupName:null,businessId:"",recipientIds:[],systemTaskType:null,notifyStatus:1,notifyScene:null,notifyThreshold:16,rateLimiterStatus:0,rateLimiterThreshold:100,description:""}}const O={groupName:D,businessId:D,notifyStatus:D,notifyScene:D,recipientIds:D,rateLimiterStatus:D,notifyThreshold:D};function K(){if(h.operateType==="add"){Object.assign(o,H()),m.value=!0;return}h.operateType==="edit"&&h.rowData&&(Object.assign(o,h.rowData),r(o.systemTaskType),l(o.notifyScene))}function Q(){g.value=!1}async function J(){var c;if(await A(),h.operateType==="add"){const{groupName:s,businessId:u,recipientIds:T,systemTaskType:$,notifyStatus:R,notifyScene:C,notifyThreshold:_,rateLimiterStatus:j,rateLimiterThreshold:B,description:G}=o,{error:P}=await He({groupName:s,businessId:u,recipientIds:T,systemTaskType:$,notifyStatus:R,notifyScene:C,notifyThreshold:_,rateLimiterStatus:j,rateLimiterThreshold:B,description:G});if(P)return}if(h.operateType==="edit"){const{id:s,groupName:u,businessId:T,recipientIds:$,notifyStatus:R,systemTaskType:C,notifyScene:_,notifyThreshold:j,rateLimiterStatus:B,rateLimiterThreshold:G,description:P}=o,{error:X}=await Ke({id:s,groupName:u,businessId:T,recipientIds:$,systemTaskType:C,notifyStatus:R,notifyScene:_,notifyThreshold:j,rateLimiterStatus:B,rateLimiterThreshold:G,description:P});if(X)return}(c=window.$message)==null||c.success(a("common.updateSuccess")),Q(),S("submitted")}async function r(c){var s,u,T,$,R;if(c===1){const C=await Xe({groupName:o.groupName});b.value=C.data,i.value=z(ue)}else if(c===3){const C=await Ze({groupName:o.groupName});y.value=(s=C.data)==null?void 0:s.map(_=>(_.id=String(_.id),_)),i.value=z(Be)}else if(c===4){const C=await Ye({groupName:o.groupName});k.value=(u=C.data)==null?void 0:u.map(_=>(_.id=String(_.id),_)),i.value=z(Me)}c!==((T=h.rowData)==null?void 0:T.systemTaskType)?(o.businessId=null,o.notifyScene=null):(o.businessId=($=h.rowData)==null?void 0:$.businessId,o.notifyScene=(R=h.rowData)==null?void 0:R.notifyScene)}async function l(c){m.value=!(c===5||c===6)}function v(c){K(),o.groupName=c,r(1),l(1)}return Ie(g,()=>{g.value&&(K(),ae())}),(c,s)=>{const u=Re,T=de,$=Le,R=$e,C=Ve,_=tt,j=xe,B=at,G=Oe,P=je,X=Y;return N(),L(fe,{modelValue:g.value,"onUpdate:modelValue":s[12]||(s[12]=p=>g.value=p),title:ne.value,"min-size":480,onHandleSubmit:J},{footer:n(()=>[t(R,{size:16},{default:n(()=>[t(X,{onClick:Q},{default:n(()=>[I(U(e(a)("common.cancel")),1)]),_:1}),t(X,{type:"primary",onClick:J},{default:n(()=>[I(U(e(a)("common.save")),1)]),_:1})]),_:1})]),default:n(()=>[t(P,{ref_key:"formRef",ref:d,model:o,rules:O},{default:n(()=>[t(u,{label:e(a)("page.notifyConfig.groupName"),path:"groupName"},{default:n(()=>[t(et,{modelValue:o.groupName,"onUpdate:modelValue":[s[0]||(s[0]=p=>o.groupName=p),v]},null,8,["modelValue"])]),_:1},8,["label"]),t(u,{label:e(a)("page.notifyConfig.systemTaskType"),path:"systemTaskType"},{default:n(()=>[t(T,{value:o.systemTaskType,"onUpdate:value":[s[1]||(s[1]=p=>o.systemTaskType=p),r],placeholder:e(a)("page.notifyConfig.form.systemTaskType"),options:e(z)(e(Ue)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),o.systemTaskType===1?(N(),L(u,{key:0,label:e(a)("page.notifyConfig.retryScene"),path:"businessId"},{default:n(()=>[t(T,{value:o.businessId,"onUpdate:value":s[2]||(s[2]=p=>o.businessId=p),placeholder:e(a)("page.notifyConfig.form.sceneName"),options:b.value,"label-field":"sceneName","value-field":"sceneName",clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])):q("",!0),o.systemTaskType===3?(N(),L(u,{key:1,label:e(a)("page.notifyConfig.job"),path:"businessId"},{default:n(()=>[t(T,{value:o.businessId,"onUpdate:value":s[3]||(s[3]=p=>o.businessId=p),placeholder:e(a)("page.notifyConfig.form.jobName"),options:y.value,"label-field":"jobName","value-field":"id",clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])):q("",!0),o.systemTaskType===4?(N(),L(u,{key:2,label:e(a)("page.notifyConfig.workflow"),path:"businessId"},{default:n(()=>[t(T,{value:o.businessId,"onUpdate:value":s[4]||(s[4]=p=>o.businessId=p),placeholder:e(a)("page.notifyConfig.form.workflowName"),options:k.value,"label-field":"workflowName","value-field":"id",clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"])):q("",!0),t(u,{label:e(a)("page.notifyConfig.notifyScene"),path:"notifyScene"},{default:n(()=>[t(T,{value:o.notifyScene,"onUpdate:value":[s[5]||(s[5]=p=>o.notifyScene=p),l],placeholder:e(a)("page.notifyConfig.form.notifyScene"),options:i.value,clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),t(u,{label:e(a)("page.notifyConfig.notifyRecipient"),path:"recipientIds"},{default:n(()=>[t(T,{value:o.recipientIds,"onUpdate:value":s[6]||(s[6]=p=>o.recipientIds=p),placeholder:e(a)("page.notifyConfig.form.notifyRecipient"),options:f.value,clearable:"",multiple:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),t(B,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:n(()=>[t(_,null,{default:n(()=>[t(u,{label:e(a)("page.notifyConfig.notifyStatus"),path:"notifyStatus"},{default:n(()=>[t(C,{value:o.notifyStatus,"onUpdate:value":s[7]||(s[7]=p=>o.notifyStatus=p),name:"notifyStatus"},{default:n(()=>[t(R,null,{default:n(()=>[(N(!0),le(se,null,ie(e(re),p=>(N(),L($,{key:p.value,value:p.value,label:e(a)(p.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["label"])]),_:1}),t(_,null,{default:n(()=>[t(u,{label:e(a)("page.notifyConfig.notifyThreshold"),path:"notifyThreshold"},{default:n(()=>[t(j,{value:o.notifyThreshold,"onUpdate:value":s[8]||(s[8]=p=>o.notifyThreshold=p),min:1,placeholder:e(a)("page.notifyConfig.form.notifyThreshold"),disabled:m.value},null,8,["value","placeholder","disabled"])]),_:1},8,["label"])]),_:1})]),_:1}),t(B,{cols:"2 s:1 m:2",responsive:"screen","x-gap":"20"},{default:n(()=>[t(_,null,{default:n(()=>[t(u,{label:e(a)("page.notifyConfig.rateLimiterStatus"),path:"rateLimiterStatus"},{default:n(()=>[t(C,{value:o.rateLimiterStatus,"onUpdate:value":s[9]||(s[9]=p=>o.rateLimiterStatus=p),name:"rateLimiterStatus",disabled:m.value},{default:n(()=>[t(R,null,{default:n(()=>[(N(!0),le(se,null,ie(e(re),p=>(N(),L($,{key:p.value,value:p.value,label:e(a)(p.label)},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value","disabled"])]),_:1},8,["label"])]),_:1}),t(_,null,{default:n(()=>[t(u,{label:e(a)("page.notifyConfig.rateLimiterThreshold"),path:"notifyThreshold"},{default:n(()=>[t(j,{value:o.rateLimiterThreshold,"onUpdate:value":s[10]||(s[10]=p=>o.rateLimiterThreshold=p),min:1,placeholder:e(a)("page.notifyConfig.form.notifyThreshold"),disabled:m.value},null,8,["value","placeholder","disabled"])]),_:1},8,["label"])]),_:1})]),_:1}),t(u,{label:e(a)("page.notifyConfig.description"),path:"description"},{default:n(()=>[t(G,{value:o.description,"onUpdate:value":s[11]||(s[11]=p=>o.description=p),type:"textarea",placeholder:e(a)("page.notifyConfig.form.description")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),ut=te({name:"NotifyConfigSearch",__name:"notify-config-search",props:{model:{required:!0},modelModifiers:{}},emits:Z(["reset","search"],["update:model"]),setup(w,{emit:x}){const f=x,b=ee(w,"model");function y(){f("reset")}function k(){f("search")}return(h,S)=>{const g=de,m=ge,i=be;return N(),L(i,{model:b.value,onSearch:k,onReset:y},{default:n(()=>[t(m,{span:"24 s:12 m:6",label:e(a)("page.notifyConfig.groupName"),path:"groupName",class:"pr-24px"},{default:n(()=>[t(g,{value:b.value.groupName,"onUpdate:value":S[0]||(S[0]=d=>b.value.groupName=d),placeholder:e(a)("page.notifyConfig.groupName"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),t(m,{span:"24 s:12 m:6",label:e(a)("page.notifyConfig.notifyStatus"),path:"notifyStatus",class:"pr-24px"},{default:n(()=>[t(g,{value:b.value.notifyStatus,"onUpdate:value":S[1]||(S[1]=d=>b.value.notifyStatus=d),placeholder:e(a)("page.notifyConfig.notifyStatus"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"]),t(m,{span:"24 s:12 m:6",label:e(a)("page.notifyConfig.notifyScene"),path:"notifyScene",class:"pr-24px"},{default:n(()=>[t(g,{value:b.value.notifyScene,"onUpdate:value":S[2]||(S[2]=d=>b.value.notifyScene=d),placeholder:e(a)("page.notifyConfig.notifyScene"),clearable:""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),pt=te({name:"NotifyConfigDetailDrawer",__name:"notify-config-detail-drawer",props:Z({rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(w){const x=ee(w,"visible");return(f,b)=>{const y=ot,k=W,h=lt,S=fe;return N(),L(S,{modelValue:x.value,"onUpdate:modelValue":b[0]||(b[0]=g=>x.value=g),title:e(a)("page.groupConfig.detail")},{default:n(()=>[t(h,{"label-placement":"top",bordered:"",column:2},{default:n(()=>{var g,m;return[t(y,{label:e(a)("page.notifyConfig.businessName"),span:2},{default:n(()=>{var i;return[I(U((i=f.rowData)==null?void 0:i.businessName),1)]}),_:1},8,["label"]),t(y,{label:e(a)("page.groupConfig.groupName"),span:2},{default:n(()=>{var i;return[I(U((i=f.rowData)==null?void 0:i.groupName),1)]}),_:1},8,["label"]),t(y,{label:e(a)("page.notifyConfig.systemTaskType"),span:1},{default:n(()=>{var i;return[t(k,{type:e(V)((i=f.rowData)==null?void 0:i.systemTaskType)},{default:n(()=>{var d;return[I(U(e(a)(e(ce)[(d=f.rowData)==null?void 0:d.systemTaskType])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),t(y,{label:e(a)("page.notifyConfig.notifyStatus"),span:1},{default:n(()=>{var i;return[t(k,{type:e(V)((i=f.rowData)==null?void 0:i.notifyStatus)},{default:n(()=>{var d;return[I(U(e(a)(e(Fe)[(d=f.rowData)==null?void 0:d.notifyStatus])),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),((g=f.rowData)==null?void 0:g.systemTaskType)===1?(N(),L(y,{key:0,label:e(a)("page.notifyConfig.notifyScene"),span:1},{default:n(()=>{var i;return[t(k,{type:e(V)((i=f.rowData)==null?void 0:i.notifyScene)},{default:n(()=>{var d;return[I(U(e(a)(e(me)[(d=f.rowData)==null?void 0:d.notifyScene])),1)]}),_:1},8,["type"])]}),_:1},8,["label"])):q("",!0),((m=f.rowData)==null?void 0:m.systemTaskType)===3?(N(),L(y,{key:1,label:e(a)("page.notifyConfig.notifyScene"),span:1},{default:n(()=>{var i;return[t(k,{type:e(V)((i=f.rowData)==null?void 0:i.notifyScene)},{default:n(()=>{var d;return[I(U(e(a)(e(ye)[(d=f.rowData)==null?void 0:d.notifyScene])),1)]}),_:1},8,["type"])]}),_:1},8,["label"])):q("",!0),t(y,{label:e(a)("page.notifyConfig.notifyThreshold"),span:1},{default:n(()=>{var i;return[t(k,{type:e(V)((i=f.rowData)==null?void 0:i.notifyThreshold)},{default:n(()=>{var d;return[I(U((d=f.rowData)==null?void 0:d.notifyThreshold),1)]}),_:1},8,["type"])]}),_:1},8,["label"]),t(y,{label:e(a)("common.createDt"),span:2},{default:n(()=>{var i;return[I(U((i=f.rowData)==null?void 0:i.createDt),1)]}),_:1},8,["label"]),t(y,{label:e(a)("page.notifyConfig.description"),span:2},{default:n(()=>{var i;return[I(U((i=f.rowData)==null?void 0:i.description),1)]}),_:1},8,["label"])]}),_:1})]),_:1},8,["modelValue","title"])}}}),ft={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function M(w){return typeof w=="function"||Object.prototype.toString.call(w)==="[object Object]"&&!We(w)}const wt=te({name:"notify_scene",__name:"index",setup(w){const{hasAuth:x}=it(),f=Ae(),b=F(),{bool:y,setTrue:k}=Ge(!1),{columns:h,columnChecks:S,data:g,getData:m,loading:i,mobilePagination:d,searchParams:A,resetSearchParams:ae}=_e({apiFn:Qe,apiParams:{page:1,size:10,groupName:null,notifyStatus:null,notifyScene:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:a("common.index"),align:"center",width:64},{key:"businessName",title:a("page.notifyConfig.businessName"),align:"left",width:120,render:r=>{function l(){b.value=r||null,k()}return t(Y,{text:!0,tag:"a",type:"primary",onClick:l,class:"ws-normal"},{default:()=>[r.businessName]})}},{key:"groupName",title:a("page.notifyConfig.groupName"),align:"left",width:120},{key:"systemTaskType",title:a("page.notifyConfig.systemTaskType"),align:"left",width:120,render:r=>{if(r.systemTaskType===null)return null;const l=a(ce[r.systemTaskType]);return t(W,{type:V(r.systemTaskType)},M(l)?l:{default:()=>[l]})}},{key:"notifyStatus",title:a("page.notifyConfig.notifyStatus"),align:"left",width:120,render:r=>{const l=async(v,c)=>{var u;const{error:s}=await Je(r.id,v);s||(r.notifyStatus=v,(u=window.$message)==null||u.success(a("common.updateSuccess"))),c()};return t(st,{value:r.notifyStatus,"onUpdate:value":v=>r.notifyStatus=v,onFetch:l},null)}},{key:"notifyScene",title:a("page.notifyConfig.notifyScene"),align:"left",width:160,render:r=>{if(r.notifyScene===null)return null;if(r.systemTaskType===1){const l=a(me[r.notifyScene]);return t(W,{type:V(r.notifyScene)},M(l)?l:{default:()=>[l]})}if(r.systemTaskType===3){const l=a(ye[r.notifyScene]);return t(W,{type:V(r.notifyScene)},M(l)?l:{default:()=>[l]})}if(r.systemTaskType===4){const l=a(Pe[r.notifyScene]);return t(W,{type:V(r.notifyScene)},M(l)?l:{default:()=>[l]})}return null}},{key:"notifyThreshold",title:a("page.notifyConfig.notifyThreshold"),align:"left",width:120},{key:"createDt",title:a("common.createDt"),align:"left",width:120},{key:"description",title:a("page.notifyConfig.description"),align:"left",width:120},{key:"operate",title:a("common.operate"),align:"center",width:130,fixed:"right",render:r=>{let l;return t("div",{class:"flex-center gap-8px"},[t(Y,{type:"primary",ghost:!0,text:!0,size:"small",onClick:()=>J(r.id)},M(l=a("common.edit"))?l:{default:()=>[l]}),x("R_ADMIN")?t(se,null,[t(ze,{vertical:!0},null),t(ve,{onPositiveClick:()=>Q(r.id)},{default:()=>a("common.confirmDelete"),trigger:()=>{let v;return t("span",null,[t(Y,{type:"error",text:!0,ghost:!0,size:"small"},M(v=a("common.delete"))?v:{default:()=>[v]})])}})]):""])}}]}),{drawerVisible:D,operateType:ne,editingData:oe,handleAdd:o,handleEdit:H,checkedRowKeys:O}=he(g,m);async function K(){var l;const{error:r}=await pe(O.value);r||((l=window.$message)==null||l.success(a("common.deleteSuccess")),m())}async function Q(r){var v;const{error:l}=await pe([r]);l||((v=window.$message)==null||v.success(a("common.deleteSuccess")),m())}function J(r){H(r)}return(r,l)=>{const v=Se,c=nt,s=Ee;return N(),le("div",ft,[t(ut,{model:e(A),"onUpdate:model":l[0]||(l[0]=u=>E(A)?A.value=u:null),onReset:e(ae),onSearch:e(m)},null,8,["model","onReset","onSearch"]),t(s,{title:e(a)("page.notifyConfig.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper","header-class":"view-card-header"},{"header-extra":n(()=>[t(v,{columns:e(S),"onUpdate:columns":l[1]||(l[1]=u=>E(S)?S.value=u:null),"disabled-delete":e(O).length===0,loading:e(i),onAdd:e(o),onDelete:K,onRefresh:e(m)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:n(()=>[t(c,{"checked-row-keys":e(O),"onUpdate:checkedRowKeys":l[2]||(l[2]=u=>E(O)?O.value=u:null),columns:e(h),data:e(g),"flex-height":!e(f).isMobile,"scroll-x":962,loading:e(i),remote:"","row-key":u=>u.id,pagination:e(d),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),t(rt,{visible:e(D),"onUpdate:visible":l[3]||(l[3]=u=>E(D)?D.value=u:null),"operate-type":e(ne),"row-data":e(oe),onSubmitted:e(m)},null,8,["visible","operate-type","row-data","onSubmitted"]),t(pt,{visible:e(y),"onUpdate:visible":l[4]||(l[4]=u=>E(y)?y.value=u:null),"row-data":b.value},null,8,["visible","row-data"])]),_:1},8,["title"])])}}});export{wt as default};
